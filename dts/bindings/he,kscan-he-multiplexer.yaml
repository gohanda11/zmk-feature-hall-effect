# Copyright (c) 2025, cr3eperall
# SPDX-License-Identifier: MIT

description: Hall effect kscan controller that produces INPUT_HE_RC analog inputs in micrometers of height

compatible: "he,kscan-multiplexer"

include: kscan.yaml

properties:
  resolution:
    type: int
    default: 12
    enum:
      - 8
      - 10
      - 12
  address-gpios:
    description: address GPIOs ordered from LSB to MSB
    type: phandle-array
    required: true
  address-to-read-delay:
    description: Time to wait before reading the key after sending the address
    type: int
    default: 0
  wait-period-idle:
    description: Time between reads in milliseconds when no activity is detected
    type: int
    default: 5
  wait-period-press:
    description: Time between reads in milliseconds when activity is detected
    type: int
    default: 1
  kscan-forwarder:
    description: kscan-forwarder to pass the kscan callback to
    type: phandle
  calibrate:
    description: Print the raw values to serial and don't send them to the input listener
    type: boolean
  polyfit:
    description: Polynomial fit coefficients as an array of floats represented as 32-bit hex integers(first coefficient is the highest degree coefficient, last is the constant term)
    type: array
    default: #coefficients calculated for Gateron low profile magnetic jade pro
      - 0x408b2298
      - 0xc1167de4
      - 0x40fed831
      - 0xc02b2742
      - 0x3f404977
      - 0x3bd693e5
  default-calibration-min:
    description: Default minimum value to consider for calibration if not specified in the child binding
    type: int
    default: 0
  default-calibration-max:
    description: Default maximum value to consider for calibration if not specified in the child binding
    type: int
    default: 0
  default-deadzone-top:
    description: Default threshold to start producing events in micrometers from the top if not specified in the child binding
    type: int
    default: 250
  default-deadzone-bottom:
    description: Default threshold to pause producing events in micrometers from the bottom if not specified in the child binding
    type: int
    default: 250

child-binding:
  description: Per adc group configuration
  properties:
    io-channels:
      description: ADC channel for this group
      type: phandle-array
      required: true
    switch-pressed-is-higher:
      type: boolean
    address-range-min:
      description: Minimum address in this group(inclusive)
      type: int
      required: true
    address-range-max:
      description: Maximum address in this group(inclusive)
      type: int
      required: true
    switch-height:
      description: Height of the switch in micrometers
      type: int
      default: 3300
      
  child-binding:
    description: Per key configuration
    properties:
      deadzone-top:
        type: int
        description: Threshold to start producing events in micrometers from the top
        default: 250
      deadzone-bottom:
        type: int
        description: Threshold to pause producing events in micrometers from the bottom
        default: 250
      calibration-min:
        type: int
        description: Minimum value to consider for calibration
        default: 0
      calibration-max:
        type: int
        description: Maximum value to consider for calibration
        default: 0
        

